# Expression Parser

This directory contains parsers generated by [peggy](https://www.npmjs.com/package/peggy) for interpreting various DynamoDB expressions. These parsers are essential for handling Condition, Update, and Projection expressions, enabling complex data manipulation and retrieval.

These implementations especially pegjs files are brought from [Dynalite](https://github.com/architect/dynalite/tree/f1b4602d44474a92983419c8d733fcac74e389f5/db).

## Build Process

Running the `pnpm build` command will parse the `.pegjs` files and create the corresponding `.js` and `.d.ts` files.

## Core Concepts of DynamoDB Expressions

DynamoDB expressions use a combination of attribute names, attribute values, operators, and functions.

*   **Expression Attribute Names**: Used as placeholders for actual attribute names, especially when the name is a DynamoDB reserved word or contains special characters. They begin with a pound sign (`#`). For example, `#n` could be a placeholder for the attribute `Name`.
*   **Expression Attribute Values**: Used as placeholders for actual values in an expression to avoid injection issues and to handle values that are not item attributes. They begin with a colon (`:`). For example, `:v` could represent the value `5`.

For more details, see the official documentation on [Referring to Item Attributes](https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Expressions.Attributes.html), [Expression Attribute Names](https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Expressions.ExpressionAttributeNames.html), and [Expression Attribute Values](https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Expressions.ExpressionAttributeValues.html).

---

## Parsers

### 1. Condition Expression Parser (`conditionParser.pegjs`)

This parser handles condition expressions used in write operations (`PutItem`, `UpdateItem`, `DeleteItem`) and read operations (`Query`, `Scan`). A condition expression must evaluate to true for the operation to proceed.

**Syntax Features**:
*   **Comparators**: `=`, `<>`, `<`, `<=`, `>`, `>=`
*   **Keywords**: `BETWEEN`, `IN`
*   **Logical Operators**: `AND`, `OR`, `NOT`
*   **Built-in Functions**: `attribute_exists`, `attribute_not_exists`, `attribute_type`, `begins_with`, `contains`, `size`
*   **Grouping**: Parentheses `()` can be used to control the order of evaluation.

For a complete list of operators and functions, refer to the [official documentation](https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Expressions.OperatorsAndFunctions.html).

### 2. Update Expression Parser (`updateParser.pegjs`)

This parser handles update expressions for the `UpdateItem` operation, allowing for the modification of specific attributes within an item.

**Supported Actions**:
*   **`SET`**: Adds a new attribute or modifies an existing one. Can be used with functions like `if_not_exists` and `list_append`.
*   **`REMOVE`**: Deletes one or more attributes from an item.
*   **`ADD`**: Atomically increments/decrements a numeric attribute or adds elements to a Set.
*   **`DELETE`**: Removes elements from a Set.

Each action keyword can only appear once per expression. For detailed usage, see the [official documentation](https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Expressions.UpdateExpressions.html).

### 3. Projection Expression Parser (`projectionParser.pegjs`)

This parser handles projection expressions for read operations (`GetItem`, `Query`, `Scan`) to specify which attributes should be returned. This is crucial for efficient data retrieval, as it minimizes data transfer.

**Syntax Features**:
*   Retrieves a comma-separated list of attributes.
*   Supports top-level attributes (e.g., `Title`).
*   Supports nested attributes using dot notation (e.g., `Product.Details`).
*   Supports specific list elements using square bracket notation (e.g., `RelatedItems[0]`).

When attribute names are reserved words or contain special characters, Expression Attribute Names must be used. For details, see the [official documentation](https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Expressions.ProjectionExpressions.html).